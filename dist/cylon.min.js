!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.Cylon=t()}}(function(){var t;return function n(t,e,i){function r(s,u){if(!e[s]){if(!t[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var l=e[s]={exports:{}};t[s][0].call(l.exports,function(n){var e=t[s][1][n];return r(e?e:n)},l,l.exports,n,t,e,i)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,n){"use strict";var e=t("./basestar"),i=t("./utils"),r=t("./utils/helpers"),o=n.exports=function(t){t=t||{},this.name=t.name,this.robot=t.robot,this.host=t.host,this.port=t.port,this.details={},r.each(t,function(t,n){~["robot","name","adaptor","events"].indexOf(n)||(this.details[n]=t)},this)};i.subclass(o,e),o.prototype.toJSON=function(){return{name:this.name,adaptor:this.constructor.name||this.name,details:this.details}}},{"./basestar":2,"./utils":18,"./utils/helpers":19}],2:[function(t,n){"use strict";var e=t("events").EventEmitter,i=t("./utils"),r=t("./utils/helpers"),o=n.exports=function(){};i.subclass(o,e),o.prototype.proxyMethods=i.proxyFunctionsToObject,o.prototype.defineEvent=function(t){return t.sendUpdate=t.sendUpdate||!1,t.targetEventName=t.targetEventName||t.eventName,t.source.on(t.eventName,function(){var n=arguments.length>=1?[].slice.call(arguments,0):[];n.unshift(t.targetEventName),t.target.emit.apply(t.target,n),t.sendUpdate&&(n.unshift("update"),t.target.emit.apply(t.target,n))}),t.source},o.prototype.defineAdaptorEvent=function(t){return this._proxyEvents(t,this.connector,this)},o.prototype.defineDriverEvent=function(t){return this._proxyEvents(t,this.connection,this)},o.prototype._proxyEvents=function(t,n,e){return t=r.isString(t)?{eventName:t}:t,t.source=n,t.target=e,this.defineEvent(t)}},{"./utils":18,"./utils/helpers":19,events:23}],3:[function(t,n){"use strict";n.exports={logging:{},testMode:!1}},{}],4:[function(t,n){(function(e){"use strict";var i=t("async"),r=t("./logger"),o=t("./robot"),s=t("./config"),u=t("./utils"),c=t("./utils/helpers"),a=t("events").EventEmitter,l=n.exports=new a;if(l.Logger=r,l.Driver=t("./driver"),l.Adaptor=t("./adaptor"),l.Utils=u,l.IO={DigitalPin:t("./io/digital-pin"),Utils:t("./io/utils")},l.apiInstances=[],l.robots={},l.commands={},l.events=["robot_added","robot_removed"],l.robot=function(t){if(t=t||{},t.name&&this.robots[t.name]){var n=t.name;t.name=u.makeUnique(n,Object.keys(this.robots));var e="Robot names must be unique. Renaming '";e+=n+"' to '"+t.name+"'",r.warn(e)}var i=new o(t);return this.robots[i.name]=i,this.emit("robot_added",i.name),i},l.api=function(n,e){if((null==n||c.isObject(n)&&!c.isFunction(n))&&(e=n,n="http"),e=e||{},c.isString(n)){var i="cylon-api-"+n;try{n=t(i)}catch(o){if("MODULE_NOT_FOUND"===o.code){var s;return s="cylon-api-http"===i?["The HTTP API is no longer included in Cylon by default.","To use it, install the plugin module: `npm install cylon-api-http`"]:["Cannot find the "+i+" API module.","You may be able to install it: `npm install "+i+"`"],void c.each(s,c.arity(r.error,1))}throw o}}e.mcp=this;var u=new n(e);this.apiInstances.push(u),u.start()},l.start=function(){var t=c.pluck(this.robots,"start");i.parallel(t,function(){var t=u.fetch(s,"workMode","async");"sync"===t&&c.invoke(this.robots,"startWork")}.bind(this))},l.config=function(t){var n=t.logging&&s.logging!==c.extend(s.logging,t.logging);return c.isObject(t)&&(s=c.extend(s,t)),n&&r.setup(),s},l.halt=function(t){t=t||function(){};var n=c.pluck(this.robots,"halt"),e=s.haltTimeout||3e3;u.after(e,t),i.parallel(n,t)},l.toJSON=function(){return{robots:c.invoke(this.robots,"toJSON"),commands:Object.keys(this.commands),events:this.events}},"win32"===e.platform){var f=t("readline"),p={input:e.stdin,output:e.stdout};f.createInterface(p).on("SIGINT",function(){e.emit("SIGINT")})}e.on("SIGINT",function(){l.halt(function(){e.kill(e.pid)})})}).call(this,t("_process"))},{"./adaptor":1,"./config":3,"./driver":5,"./io/digital-pin":7,"./io/utils":8,"./logger":9,"./robot":13,"./utils":18,"./utils/helpers":19,_process:24,async:21,events:23,readline:22}],5:[function(t,n){"use strict";var e=t("./basestar"),i=t("./utils"),r=t("./utils/helpers"),o=n.exports=function(t){t=t||{},this.name=t.name,this.robot=t.robot,this.connection=t.connection,this.commands={},this.events=[],this.pin=t.pin,this.interval=t.interval||10,this.details={},r.each(t,function(t,n){var e=["robot","name","connection","driver","events"];~e.indexOf(n)||(this.details[n]=t)},this)};i.subclass(o,e),o.prototype.setupCommands=function(t,n){null==n&&(n=this.connection),i.proxyFunctionsToObject(t,n,this),t.forEach(function(t){var n=t.replace(/[A-Z]+/g,function(t){return t.length>1&&(t=t.replace(/[A-Z]$/,function(t){return"_"+t.toLowerCase()})),"_"+t.toLowerCase()}).replace(/^_/,"");this.commands[n]=this[t]},this)},o.prototype.toJSON=function(){return{name:this.name,driver:this.constructor.name||this.name,connection:this.connection.name,commands:Object.keys(this.commands),events:this.events,details:this.details}}},{"./basestar":2,"./utils":18,"./utils/helpers":19}],6:[function(t,n){(function(e){"use strict";function i(){return"test"===e.env.NODE_ENV&&o.testMode}var r=t("./registry"),o=t("./config"),s=t("./utils/helpers");n.exports=function(t,n){var e;e=r.findBy(t,n[t]),e||(r.register(n.module?n.module:"cylon-"+n[t]),e=r.findBy(t,n[t]));var o=e[t](n);if(s.each(o,function(t,n){"constructor"!==n&&s.isFunction(t)&&(o[n]=t.bind(o))}),i()){var u=r.findBy(t,"test")[t](n);return s.each(o,function(t,n){s.isFunction(t)&&!u[n]&&(u[n]=function(){return!0})}),u}return o}}).call(this,t("_process"))},{"./config":3,"./registry":12,"./utils/helpers":19,_process:24}],7:[function(t,n){"use strict";var e=t("fs"),i=t("events").EventEmitter,r=t("../utils"),o="/sys/class/gpio",s="in",u="out",c=n.exports=function(t){this.pinNum=t.pin.toString(),this.status="low",this.ready=!1,this.mode=t.mode};r.subclass(c,i),c.prototype.connect=function(t){null==this.mode&&(this.mode=t),e.exists(this._pinPath(),function(t){t?this._openPin():this._createGPIOPin()}.bind(this))},c.prototype.close=function(){e.writeFile(this._unexportPath(),this.pinNum,function(t){this._closeCallback(t)}.bind(this))},c.prototype.closeSync=function(){e.writeFileSync(this._unexportPath(),this.pinNum),this._closeCallback(!1)},c.prototype.digitalWrite=function(t){return"w"!==this.mode&&this._setMode("w"),this.status=1===t?"high":"low",e.writeFile(this._valuePath(),t,function(n){if(n){var e="Error occurred while writing value ";e+=t+" to pin "+this.pinNum,this.emit("error",e)}else this.emit("digitalWrite",t)}.bind(this)),t},c.prototype.digitalRead=function(t){"r"!==this.mode&&this._setMode("r"),r.every(t,function(){e.readFile(this._valuePath(),function(t,n){if(t){var e="Error occurred while reading from pin "+this.pinNum;this.emit("error",e)}else{var i=parseInt(n.toString());this.emit("digitalRead",i)}}.bind(this))}.bind(this))},c.prototype.setHigh=function(){return this.digitalWrite(1)},c.prototype.setLow=function(){return this.digitalWrite(0)},c.prototype.toggle=function(){return"low"===this.status?this.setHigh():this.setLow()},c.prototype._createGPIOPin=function(){e.writeFile(this._exportPath(),this.pinNum,function(t){t?this.emit("error","Error while creating pin files"):this._openPin()}.bind(this))},c.prototype._openPin=function(){this._setMode(this.mode,!0),this.emit("open")},c.prototype._closeCallback=function(t){t?this.emit("error","Error while closing pin files"):this.emit("close",this.pinNum)},c.prototype._setMode=function(t,n){null==n&&(n=!1),this.mode=t;var i="w"===t?u:s;e.writeFile(this._directionPath(),i,function(t){this._setModeCallback(t,n)}.bind(this))},c.prototype._setModeCallback=function(t,n){return t?this.emit("error","Setting up pin direction failed"):(this.ready=!0,void(n&&this.emit("connect",this.mode)))},c.prototype._directionPath=function(){return this._pinPath()+"/direction"},c.prototype._valuePath=function(){return this._pinPath()+"/value"},c.prototype._pinPath=function(){return o+"/gpio"+this.pinNum},c.prototype._exportPath=function(){return o+"/export"},c.prototype._unexportPath=function(){return o+"/unexport"}},{"../utils":18,events:23,fs:22}],8:[function(t,n){"use strict";n.exports={periodAndDuty:function(t,n,e,i){var r,o,s;if(i=i||"high",r=Math.round(1e9/n),null!=e){var u=1e3*e.min,c=1e3*e.max;s=c-u,o=Math.round(u+s*t)}else o=Math.round(r*t);return"low"===i&&(o=r-o),{period:r,duty:o}}}},{}],9:[function(t,n){"use strict";var e=["debug","info","warn","error","fatal"],i=t("./logger/basic_logger"),r=t("./logger/null_logger"),o=t("./config"),s=t("./utils/helpers"),u=n.exports={setup:function(t){s.isObject(t)&&(o.logging=s.extend(o.logging,t));var n=o.logging.logger,e=o.logging.level||"info";return n=null==n?i:n,this.logger=n||r,this.level=e,this},toString:function(){return this.logger.toString()}};u.setup(),e.forEach(function(t){u[t]=function(){return e.indexOf(t)>=e.indexOf(u.level)?u.logger[t].apply(u.logger,arguments):void 0}})},{"./config":3,"./logger/basic_logger":10,"./logger/null_logger":11,"./utils/helpers":19}],10:[function(t,n){"use strict";var e=function(t){return t.length>=1?[].slice.call(t,0):[]},i=function(t){var n=(new Date).toISOString(),e=String(t).toUpperCase(),i=String("      "+e).slice(-5);return e[0]+", ["+n+"] "+i+" -- :"},r=n.exports={toString:function(){return"BasicLogger"}};["debug","info","warn","error","fatal"].forEach(function(t){r[t]=function(){var n=e(arguments);return console.log.apply(console,[].concat(i(t),n))}})},{}],11:[function(t,n){"use strict";var e=n.exports={toString:function(){return"NullLogger"}};["debug","info","warn","error","fatal"].forEach(function(t){e[t]=function(){}})},{}],12:[function(t,n){(function(e){"use strict";var i=t("./logger");t("./test/loopback"),t("./test/test-adaptor"),t("./test/test-driver"),t("./test/ping");var r=function(t){var n="Cannot find the '"+t+"' module.\n";n+="This problem might be fixed by installing it with ",n+="'npm install "+t+"' and trying again.",console.log(n),e.emit("SIGINT")},o=n.exports={data:{},register:function(n){if(this.data[n])return this.data[n].module;var e;try{e=t(n)}catch(i){throw"MODULE_NOT_FOUND"===i.code&&r(n),i}return this.data[n]={module:e,adaptors:e.adaptors||[],drivers:e.drivers||[],dependencies:e.dependencies||[]},this.logRegistration(n,this.data[n]),this.data[n].dependencies.forEach(function(t){o.register(t)}),this.data[n].module},findBy:function(t,n){return/s$/.test(n)||(t+="s"),this.search(t,n)},findByModule:function(t){return this.data[t]?this.data[t].module:null},logRegistration:function(t){var n=this.data[t];i.debug("Registering module "+t),["adaptors","drivers","dependencies"].forEach(function(t){n[t].length&&(i.debug("  "+t+":"),n[t].forEach(function(t){i.debug("    - "+t)}))})},search:function(t,n){for(var e in this.data){var i=this.data[e];if(~i[t].indexOf(n))return i.module}return!1}};["loopback","ping","test-adaptor","test-driver"].forEach(function(t){o.register("./test/"+t)})}).call(this,t("_process"))},{"./logger":9,"./test/loopback":14,"./test/ping":15,"./test/test-adaptor":16,"./test/test-driver":17,_process:24}],13:[function(t,n){(function(e){"use strict";var i=t("./initializer"),r=t("./logger"),o=t("./utils"),s=t("./config"),u=t("./utils/helpers"),c=t("async"),a=t("events").EventEmitter,l=n.exports=function(t){t=t||{};var n=["toString","halt","startDevices","startConnections","start","initRobot","initDevices","initConnections","log"];if(n.forEach(function(t){this[t]=this[t].bind(this)},this),this.initRobot(t),this.initConnections(t),this.initDevices(t),u.each(t,function(n,e){void 0===this[e]&&(this[e]=n,null==t.commands&&u.isFunction(n)&&(this.commands[e]=n))},this),t.commands){var e;if(e=u.isFunction(t.commands)?t.commands.call(this):t.commands,!u.isObject(e)){var i="#commands must be an object ";throw i+="or a function that returns an object",new Error(i)}this.commands=e}var r=o.fetch(s,"mode","manual");"auto"===r&&setTimeout(this.start,0)};o.subclass(l,a),l.randomName=function(){return"Robot "+Math.floor(1e5*Math.random())},l.prototype.toJSON=function(){return{name:this.name,connections:u.invoke(this.connections,"toJSON"),devices:u.invoke(this.devices,"toJSON"),commands:Object.keys(this.commands),events:u.isArray(this.events)?this.events:[]}},l.prototype.connection=function(t,n){if(n.robot=this,n.name=t,this.connections[n.name]){var e,r=n.name;n.name=o.makeUnique(r,Object.keys(this.connections)),e="Connection names must be unique.",e+="Renaming '"+r+"' to '"+n.name+"'",this.log("warn",e)}return this.connections[n.name]=i("adaptor",n),this},l.prototype.initRobot=function(t){this.name=t.name||l.randomName(),this.connections={},this.devices={},this.adaptors={},this.drivers={},this.commands={},this.running=!1,this.work=t.work||t.play,this.work||(this.work=function(){this.log("debug","No work yet.")})},l.prototype.initConnections=function(t){if(this.log("info","Initializing connections."),null==t.connection&&null==t.connections)return this.connections;if(t.connection)return this.deprecationWarning("connection"),this.connection(t.connection.name,t.connection),this.connections;if(u.isObjectLoose(t.connections)){if(u.isArray(t.connections))return this.performArraySetup(t.connections,"connection","connections"),this.connections;u.each(t.connections,function(n,e){var i=u.isString(e)?e:n.name;n.devices&&(t.devices=t.devices||{},u.each(n.devices,function(n,e){n.connection=i,t.devices[e]=n}),delete n.devices),this.connection(i,n)},this)}return this.connections},l.prototype.device=function(t,n){var r;if(n.robot=this,n.name=t,this.devices[n.name]){var s=n.name;n.name=o.makeUnique(s,Object.keys(this.devices)),r="Device names must be unique.",r+="Renaming '"+s+"' to '"+n.name+"'",this.log("warn",r)}if(u.isString(n.connection))null==this.connections[n.connection]&&(r="No connection found with the name "+n.connection+".\n",this.log("fatal",r),e.emit("SIGINT")),n.connection=this.connections[n.connection];else for(var c in this.connections){n.connection=this.connections[c];break}return this.devices[n.name]=i("driver",n),this},l.prototype.initDevices=function(t){if(this.log("info","Initializing devices."),null==t.device&&null==t.devices)return this.devices;if(!Object.keys(this.connections).length)throw new Error("No connections specified");if(t.device)return this.deprecationWarning("device"),this.device(t.device.name,t.device),this.devices;if(u.isObjectLoose(t.devices)){if(u.isArray(t.devices))return this.performArraySetup(t.devices,"device","devices"),this.devices;u.each(t.devices,function(t,n){var e=u.isString(n)?n:t.name;this.device(e,t)},this)}return this.devices},l.prototype.start=function(t){if(this.running)return this;var n=o.fetch(s,"workMode","async"),e=function(){"async"===n&&this.startWork()}.bind(this);return c.series([this.startConnections,this.startDevices,e],function(n,e){n&&(this.log("fatal","An error occured while trying to start the robot:"),this.log("fatal",n),this.halt(function(){u.isFunction(this.error)&&this.error.call(this,n),this.listeners("error").length&&this.emit("error",n)}.bind(this))),u.isFunction(t)&&t(n,e)}.bind(this)),this},l.prototype.startWork=function(){this.log("info","Working."),this.emit("ready",this),this.work.call(this,this),this.running=!0},l.prototype.startConnections=function(t){this.log("info","Starting connections.");var n=u.map(this.connections,function(t,n){return this[n]=t,function(e){var i="Starting connection '"+n+"'";return t.host?i+=" on host "+t.host:t.port&&(i+=" on port "+t.port),this.log("debug",i+"."),t.connect.call(t,e)}.bind(this)},this);return c.parallel(n,t)},l.prototype.startDevices=function(t){var n=this.log;n("info","Starting devices.");var e=u.map(this.devices,function(t,e){return this[e]=t,function(i){var r="Starting device '"+e+"'";return t.pin&&(r+=" on pin "+t.pin),n("debug",r+"."),t.start.call(t,i)}},this);return c.parallel(e,t)},l.prototype.halt=function(t){if(t=t||function(){},!this.isRunning)return t();var n=u.pluck(this.devices,"halt"),e=u.pluck(this.connections,"disconnect");try{c.parallel(n,function(){c.parallel(e,t)})}catch(i){var r="An error occured while attempting to safely halt the robot";this.log("error",r),this.log("error",i.message)}this.running=!1},l.prototype.toString=function(){return"[Robot name='"+this.name+"']"},l.prototype.log=function(t){var n=Array.prototype.slice.call(arguments,1);n.unshift("["+this.name+"] -"),r[t].apply(null,n)},l.prototype.performArraySetup=function(t,n,e){var i="Specifying ";i+=e,i+=" as an array is deprecated. ",i+="It will be removed in 1.0.0.",this.log("warn",i),t.forEach(function(t,e){var i="string"===u.isString(e)?e:t.name;this[n](i,t)},this)},l.prototype.deprecationWarning=function(t){var n="Specifying a single ";n+=t,n+=" with the '",n+=t,n+="' key ",n+="is deprecated. It will be removed in 1.0.0.",this.log("warn",n)}}).call(this,t("_process"))},{"./config":3,"./initializer":6,"./logger":9,"./utils":18,"./utils/helpers":19,_process:24,async:21,events:23}],14:[function(t,n){"use strict";var e,i=t("../adaptor"),r=t("../utils");n.exports=e=function o(){o.__super__.constructor.apply(this,arguments)},r.subclass(e,i),e.prototype.connect=function(t){t()},e.prototype.disconnect=function(t){t()},e.adaptors=["loopback"],e.adaptor=function(t){return new e(t)}},{"../adaptor":1,"../utils":18}],15:[function(t,n){"use strict";var e=t("../driver"),i=t("../utils"),r=n.exports=function o(){o.__super__.constructor.apply(this,arguments),this.commands={ping:this.ping},this.events=["ping"]};i.subclass(r,e),r.prototype.ping=function(){return this.emit("ping","ping"),"pong"},r.prototype.start=function(t){t()},r.prototype.halt=function(t){t()},r.drivers=["ping"],r.driver=function(t){return new r(t)}},{"../driver":5,"../utils":18}],16:[function(t,n){"use strict";var e,i=t("../adaptor"),r=t("../utils");n.exports=e=function o(){o.__super__.constructor.apply(this,arguments)},r.subclass(e,i),e.adaptors=["test"],e.adaptor=function(t){return new e(t)}},{"../adaptor":1,"../utils":18}],17:[function(t,n){"use strict";var e,i=t("../driver"),r=t("../utils");n.exports=e=function o(){o.__super__.constructor.apply(this,arguments)},r.subclass(e,i),e.drivers=["test"],e.driver=function(t){return new e(t)}},{"../driver":5,"../utils":18}],18:[function(t,n){(function(e){"use strict";var i=t("./utils/helpers"),r=t("./utils/monkey-patches"),o=n.exports={every:function(t,n){return setInterval(n,t)},after:function(t,n){return setTimeout(n,t)},constantly:function(t){return every(0,t)},sleep:function(t){for(var n,e=Date.now();Date.now()<e+t;)n=0},subclass:function(t,n){var e=function(){this.constructor=t};for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},proxyFunctions:function(t,n){i.each(t,function(e,r){i.isFunction(e)&&!n[r]&&(n[r]=e.bind(t))})},proxyFunctionsToObject:function(t,n,e,r){return null==e&&(e=this),r=r||!1,t.forEach(function(t){(!i.isFunction(e[t])||r)&&(e[t]=function(){return n[t].apply(n,arguments)})}),e},fetch:function(t,n,e){if(t.hasOwnProperty(n))return t[n];if(void 0===e)throw new Error('key not found: "'+n+'"');if(i.isFunction(e)){var r=e(n);if(void 0===r)throw new Error("no return value from provided fallback function");return r}return e},makeUnique:function(t,n){var e;if(!~n.indexOf(t))return t;for(var i=1;;i++)if(e=t+"-"+i,!~n.indexOf(e))return e},bootstrap:function(){return e.every=this.every,e.after=this.after,e.constantly=this.constantly,r.install(),this}};o.bootstrap()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils/helpers":19,"./utils/monkey-patches":20}],19:[function(t,n){"use strict";function e(t){return t}function i(t,n){var e=Array.isArray(n);if(null==t&&(t=e?[]:{}),e)n.forEach(function(n,e){"undefined"==typeof t[e]?t[e]=n:"object"==typeof n?t[e]=i(t[e],n):~t.indexOf(n)||t.push(n)});else{var r;for(r in n)"object"==typeof n[r]&&n[r]&&t[r]?i(t[r],n[r]):t[r]=n[r]}return t}function r(t){return Object.prototype.toString.call(t).slice(8,-1)}function o(t){return function(n){return r(n)===t}}function s(t,n,e){if(v.isArray(t))return void t.forEach(n,e);if(v.isObject(t))for(var i in t){var r=t[i];n.call(e,r,i)}return[]}function u(t,n){var e=[];return s(t,function(t){v.isObject(t)&&e.push(v.isFunction(t[n])?t[n].bind(t):t[n])}),e}function c(t,n,i){var r=[];return null==n&&(n=e),s(t,function(t,e){r.push(n.call(i,t,e))}),r}function a(t,n){var e=d.call(arguments,2),i=[];return s(t,function(t){return v.isFunction(n)?void i.push(n.apply(t,e)):void i.push(t[n].apply(t,arguments))}),i}function l(t,n,i,r){var o=v.isArray(t);if(!o&&!v.isObjectLoose(t))return null;if(null==n&&(n=e),null==i)if(o)i=t.shift();else for(var u in t){i=t[u],delete t[u];break}return s(t,function(t,e){i=n.call(r,i,t,e)}),i}function f(t,n){return function(){var e=d.call(arguments,0,n);return t.apply(null,e)}}function p(t){var n=d.call(arguments,1);return function(){return t.apply(null,n.concat(d.call(arguments)))}}function h(t){var n=d.call(arguments,1);return function(){return t.apply(null,d.call(arguments).concat(n))}}var d=Array.prototype.slice,v=n.exports={};i(v,{identity:e,extend:i}),i(v,{isObject:o("Object"),isObjectLoose:function(t){return"object"==typeof t},isFunction:o("Function"),isArray:o("Array"),isString:o("String"),isNumber:o("Number"),isArguments:o("Arguments"),isUndefined:o("Undefined")}),i(v,{pluck:u,each:s,map:c,invoke:a,reduce:l}),i(v,{arity:f,partial:p,partialRight:h})},{}],20:[function(t,n){"use strict";var e=Math.max,i=Math.min;n.exports.install=function(){Number.prototype.seconds=function(){return 1e3*this},Number.prototype.second=Number.prototype.seconds,Number.prototype.fromScale=function(t,n){var r=(this-i(t,n))/(e(t,n)-i(t,n));return r>1?1:0>r?0:r},Number.prototype.toScale=function(t,n){var r=this*(e(t,n)-i(t,n))+i(t,n);return t>r?t:r>n?n:r}}},{}],21:[function(n,e){(function(n){!function(){function i(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(r,arguments)}}var r,o,s={};r=this,null!=r&&(o=r.async),s.noConflict=function(){return r.async=o,s};var u=Object.prototype.toString,c=Array.isArray||function(t){return"[object Array]"===u.call(t)},a=function(t,n){if(t.forEach)return t.forEach(n);for(var e=0;e<t.length;e+=1)n(t[e],e,t)},l=function(t,n){if(t.map)return t.map(n);var e=[];return a(t,function(t,i,r){e.push(n(t,i,r))}),e},f=function(t,n,e){return t.reduce?t.reduce(n,e):(a(t,function(t,i,r){e=n(e,t,i,r)}),e)},p=function(t){if(Object.keys)return Object.keys(t);var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n};"undefined"!=typeof n&&n.nextTick?(s.nextTick=n.nextTick,s.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:s.nextTick):"function"==typeof setImmediate?(s.nextTick=function(t){setImmediate(t)},s.setImmediate=s.nextTick):(s.nextTick=function(t){setTimeout(t,0)},s.setImmediate=s.nextTick),s.each=function(t,n,e){function r(n){n?(e(n),e=function(){}):(o+=1,o>=t.length&&e())}if(e=e||function(){},!t.length)return e();var o=0;a(t,function(t){n(t,i(r))})},s.forEach=s.each,s.eachSeries=function(t,n,e){if(e=e||function(){},!t.length)return e();var i=0,r=function(){n(t[i],function(n){n?(e(n),e=function(){}):(i+=1,i>=t.length?e():r())})};r()},s.forEachSeries=s.eachSeries,s.eachLimit=function(t,n,e,i){var r=h(n);r.apply(null,[t,e,i])},s.forEachLimit=s.eachLimit;var h=function(t){return function(n,e,i){if(i=i||function(){},!n.length||0>=t)return i();var r=0,o=0,s=0;!function u(){if(r>=n.length)return i();for(;t>s&&o<n.length;)o+=1,s+=1,e(n[o-1],function(t){t?(i(t),i=function(){}):(r+=1,s-=1,r>=n.length?i():u())})}()}},d=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[s.each].concat(n))}},v=function(t,n){return function(){var e=Array.prototype.slice.call(arguments);return n.apply(null,[h(t)].concat(e))}},m=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[s.eachSeries].concat(n))}},g=function(t,n,e,i){if(n=l(n,function(t,n){return{index:n,value:t}}),i){var r=[];t(n,function(t,n){e(t.value,function(e,i){r[t.index]=i,n(e)})},function(t){i(t,r)})}else t(n,function(t,n){e(t.value,function(t){n(t)})})};s.map=d(g),s.mapSeries=m(g),s.mapLimit=function(t,n,e,i){return y(n)(t,e,i)};var y=function(t){return v(t,g)};s.reduce=function(t,n,e,i){s.eachSeries(t,function(t,i){e(n,t,function(t,e){n=e,i(t)})},function(t){i(t,n)})},s.inject=s.reduce,s.foldl=s.reduce,s.reduceRight=function(t,n,e,i){var r=l(t,function(t){return t}).reverse();s.reduce(r,n,e,i)},s.foldr=s.reduceRight;var b=function(t,n,e,i){var r=[];n=l(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e&&r.push(t),n()})},function(){i(l(r.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};s.filter=d(b),s.filterSeries=m(b),s.select=s.filter,s.selectSeries=s.filterSeries;var _=function(t,n,e,i){var r=[];n=l(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e||r.push(t),n()})},function(){i(l(r.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};s.reject=d(_),s.rejectSeries=m(_);var w=function(t,n,e,i){t(n,function(t,n){e(t,function(e){e?(i(t),i=function(){}):n()})},function(){i()})};s.detect=d(w),s.detectSeries=m(w),s.some=function(t,n,e){s.each(t,function(t,i){n(t,function(t){t&&(e(!0),e=function(){}),i()})},function(){e(!1)})},s.any=s.some,s.every=function(t,n,e){s.each(t,function(t,i){n(t,function(t){t||(e(!1),e=function(){}),i()})},function(){e(!0)})},s.all=s.every,s.sortBy=function(t,n,e){s.map(t,function(t,e){n(t,function(n,i){n?e(n):e(null,{value:t,criteria:i})})},function(t,n){if(t)return e(t);var i=function(t,n){var e=t.criteria,i=n.criteria;return i>e?-1:e>i?1:0};e(null,l(n.sort(i),function(t){return t.value}))})},s.auto=function(t,n){n=n||function(){};var e=p(t),i=e.length;if(!i)return n();var r={},o=[],u=function(t){o.unshift(t)},l=function(t){for(var n=0;n<o.length;n+=1)if(o[n]===t)return void o.splice(n,1)},h=function(){i--,a(o.slice(0),function(t){t()})};u(function(){if(!i){var t=n;n=function(){},t(null,r)}}),a(e,function(e){var i=c(t[e])?t[e]:[t[e]],o=function(t){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),t){var o={};a(p(r),function(t){o[t]=r[t]}),o[e]=i,n(t,o),n=function(){}}else r[e]=i,s.setImmediate(h)},d=i.slice(0,Math.abs(i.length-1))||[],v=function(){return f(d,function(t,n){return t&&r.hasOwnProperty(n)},!0)&&!r.hasOwnProperty(e)};if(v())i[i.length-1](o,r);else{var m=function(){v()&&(l(m),i[i.length-1](o,r))};u(m)}})},s.retry=function(t,n,e){var i=5,r=[];"function"==typeof t&&(e=n,n=t,t=i),t=parseInt(t,10)||i;var o=function(i,o){for(var u=function(t,n){return function(e){t(function(t,i){e(!t||n,{err:t,result:i})},o)}};t;)r.push(u(n,!(t-=1)));s.series(r,function(t,n){n=n[n.length-1],(i||e)(n.err,n.result)})};return e?o():o},s.waterfall=function(t,n){if(n=n||function(){},!c(t)){var e=new Error("First argument to waterfall must be an array of functions");return n(e)}if(!t.length)return n();var i=function(t){return function(e){if(e)n.apply(null,arguments),n=function(){};else{var r=Array.prototype.slice.call(arguments,1),o=t.next();r.push(o?i(o):n),s.setImmediate(function(){t.apply(null,r)})}}};i(s.iterator(t))()};var k=function(t,n,e){if(e=e||function(){},c(n))t.map(n,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},e);else{var i={};t.each(p(n),function(t,e){n[t](function(n){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[t]=r,e(n)})},function(t){e(t,i)})}};s.parallel=function(t,n){k({map:s.map,each:s.each},t,n)},s.parallelLimit=function(t,n,e){k({map:y(n),each:h(n)},t,e)},s.series=function(t,n){if(n=n||function(){},c(t))s.mapSeries(t,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},n);else{var e={};s.eachSeries(p(t),function(n,i){t[n](function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),e[n]=r,i(t)})},function(t){n(t,e)})}},s.iterator=function(t){var n=function(e){var i=function(){return t.length&&t[e].apply(null,arguments),i.next()};return i.next=function(){return e<t.length-1?n(e+1):null},i};return n(0)},s.apply=function(t){var n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,n.concat(Array.prototype.slice.call(arguments)))}};var x=function(t,n,e,i){var r=[];t(n,function(t,n){e(t,function(t,e){r=r.concat(e||[]),n(t)})},function(t){i(t,r)})};s.concat=d(x),s.concatSeries=m(x),s.whilst=function(t,n,e){t()?n(function(i){return i?e(i):void s.whilst(t,n,e)}):e()},s.doWhilst=function(t,n,e){t(function(i){if(i)return e(i);var r=Array.prototype.slice.call(arguments,1);n.apply(null,r)?s.doWhilst(t,n,e):e()})},s.until=function(t,n,e){t()?e():n(function(i){return i?e(i):void s.until(t,n,e)})},s.doUntil=function(t,n,e){t(function(i){if(i)return e(i);var r=Array.prototype.slice.call(arguments,1);n.apply(null,r)?e():s.doUntil(t,n,e)})},s.queue=function(t,n){function e(t,n,e,i){return t.started||(t.started=!0),c(n)||(n=[n]),0==n.length?s.setImmediate(function(){t.drain&&t.drain()}):void a(n,function(n){var r={data:n,callback:"function"==typeof i?i:null};e?t.tasks.unshift(r):t.tasks.push(r),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}void 0===n&&(n=1);var r=0,o={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,n){e(o,t,!1,n)},kill:function(){o.drain=null,o.tasks=[]},unshift:function(t,n){e(o,t,!0,n)},process:function(){if(!o.paused&&r<o.concurrency&&o.tasks.length){var n=o.tasks.shift();o.empty&&0===o.tasks.length&&o.empty(),r+=1;var e=function(){r-=1,n.callback&&n.callback.apply(n,arguments),o.drain&&o.tasks.length+r===0&&o.drain(),o.process()},s=i(e);t(n.data,s)}},length:function(){return o.tasks.length},running:function(){return r},idle:function(){return o.tasks.length+r===0},pause:function(){o.paused!==!0&&(o.paused=!0,o.process())},resume:function(){o.paused!==!1&&(o.paused=!1,o.process())}};return o},s.priorityQueue=function(t,n){function e(t,n){return t.priority-n.priority}function i(t,n,e){for(var i=-1,r=t.length-1;r>i;){var o=i+(r-i+1>>>1);e(n,t[o])>=0?i=o:r=o-1}return i}function r(t,n,r,o){return t.started||(t.started=!0),c(n)||(n=[n]),0==n.length?s.setImmediate(function(){t.drain&&t.drain()}):void a(n,function(n){var u={data:n,priority:r,callback:"function"==typeof o?o:null};t.tasks.splice(i(t.tasks,u,e)+1,0,u),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),s.setImmediate(t.process)})}var o=s.queue(t,n);return o.push=function(t,n,e){r(o,t,n,e)},delete o.unshift,o},s.cargo=function(t,n){var e=!1,i=[],r={tasks:i,payload:n,saturated:null,empty:null,drain:null,drained:!0,push:function(t,e){c(t)||(t=[t]),a(t,function(t){i.push({data:t,callback:"function"==typeof e?e:null}),r.drained=!1,r.saturated&&i.length===n&&r.saturated()}),s.setImmediate(r.process)},process:function o(){if(!e){if(0===i.length)return r.drain&&!r.drained&&r.drain(),void(r.drained=!0);var s="number"==typeof n?i.splice(0,n):i.splice(0,i.length),u=l(s,function(t){return t.data});r.empty&&r.empty(),e=!0,t(u,function(){e=!1;var t=arguments;a(s,function(n){n.callback&&n.callback.apply(null,t)}),o()})}},length:function(){return i.length},running:function(){return e}};return r};var E=function(t){return function(n){var e=Array.prototype.slice.call(arguments,1);n.apply(null,e.concat([function(n){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(n?console.error&&console.error(n):console[t]&&a(e,function(n){console[t](n)
}))}]))}};s.log=E("log"),s.dir=E("dir"),s.memoize=function(t,n){var e={},i={};n=n||function(t){return t};var r=function(){var r=Array.prototype.slice.call(arguments),o=r.pop(),u=n.apply(null,r);u in e?s.nextTick(function(){o.apply(null,e[u])}):u in i?i[u].push(o):(i[u]=[o],t.apply(null,r.concat([function(){e[u]=arguments;var t=i[u];delete i[u];for(var n=0,r=t.length;r>n;n++)t[n].apply(null,arguments)}])))};return r.memo=e,r.unmemoized=t,r},s.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},s.times=function(t,n,e){for(var i=[],r=0;t>r;r++)i.push(r);return s.map(i,n,e)},s.timesSeries=function(t,n,e){for(var i=[],r=0;t>r;r++)i.push(r);return s.mapSeries(i,n,e)},s.seq=function(){var t=arguments;return function(){var n=this,e=Array.prototype.slice.call(arguments),i=e.pop();s.reduce(t,e,function(t,e,i){e.apply(n,t.concat([function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1);i(t,n)}]))},function(t,e){i.apply(n,[t].concat(e))})}},s.compose=function(){return s.seq.apply(null,Array.prototype.reverse.call(arguments))};var S=function(t,n){var e=function(){var e=this,i=Array.prototype.slice.call(arguments),r=i.pop();return t(n,function(t,n){t.apply(e,i.concat([n]))},r)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return e.apply(this,i)}return e};s.applyEach=d(S),s.applyEachSeries=m(S),s.forever=function(t,n){function e(i){if(i){if(n)return n(i);throw i}t(e)}e()},"undefined"!=typeof e&&e.exports?e.exports=s:"undefined"!=typeof t&&t.amd?t([],function(){return s}):r.async=s}()}).call(this,n("_process"))},{_process:24}],22:[function(){},{}],23:[function(t,n){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}n.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(t){if(!r(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},e.prototype.emit=function(t){var n,e,r,u,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(n=arguments[1],n instanceof Error)throw n;throw TypeError('Uncaught, unspecified "error" event.')}if(e=this._events[t],s(e))return!1;if(i(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,u=new Array(r-1),c=1;r>c;c++)u[c-1]=arguments[c];e.apply(this,u)}else if(o(e)){for(r=arguments.length,u=new Array(r-1),c=1;r>c;c++)u[c-1]=arguments[c];for(a=e.slice(),r=a.length,c=0;r>c;c++)a[c].apply(this,u)}return!0},e.prototype.addListener=function(t,n){var r;if(!i(n))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(n.listener)?n.listener:n),this._events[t]?o(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,o(this._events[t])&&!this._events[t].warned){var r;r=s(this._maxListeners)?e.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(t,n){function e(){this.removeListener(t,e),r||(r=!0,n.apply(this,arguments))}if(!i(n))throw TypeError("listener must be a function");var r=!1;return e.listener=n,this.on(t,e),this},e.prototype.removeListener=function(t,n){var e,r,s,u;if(!i(n))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(e=this._events[t],s=e.length,r=-1,e===n||i(e.listener)&&e.listener===n)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,n);else if(o(e)){for(u=s;u-->0;)if(e[u]===n||e[u].listener&&e[u].listener===n){r=u;break}if(0>r)return this;1===e.length?(e.length=0,delete this._events[t]):e.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,n)}return this},e.prototype.removeAllListeners=function(t){var n,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[t],i(e))this.removeListener(t,e);else for(;e.length;)this.removeListener(t,e[e.length-1]);return delete this._events[t],this},e.prototype.listeners=function(t){var n;return n=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},e.listenerCount=function(t,n){var e;return e=t._events&&t._events[n]?i(t._events[n])?1:t._events[n].length:0}},{}],24:[function(t,n){function e(){if(!s){s=!0;for(var t,n=o.length;n;){t=o,o=[];for(var e=-1;++e<n;)t[e]();n=o.length}s=!1}}function i(){}var r=n.exports={},o=[],s=!1;r.nextTick=function(t){o.push(t),s||setTimeout(e,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.on=i,r.addListener=i,r.once=i,r.off=i,r.removeListener=i,r.removeAllListeners=i,r.emit=i,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}]},{},[4])(4)});